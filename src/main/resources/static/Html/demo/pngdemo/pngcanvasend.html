<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../ElementCreatorFrame/ZCElementer.js"></script>
    <script src="../../../js/jquery-1.11.0.min.js"></script>
    <script src="../../../js/Config.js"></script>
    <script src="../ElementCreatorFrame/ZCCanvas.js"></script>
    <style>
        .nameDiv{
            position: absolute;
            width: 10%;
            height: 5%;
            bottom: 22%;
            background: #aa1111;
            z-index: 10;

        }
        .showImg{
            position: absolute;
            width: 200px;
            height: 400px;
            left: 40%;
            background: #aa1111;
            transform: rotate(90deg);
        }
        .mainCanvas{
            position: absolute;
            left: 30%;

        }

    </style>
    <script>
        window.onload = function (ev) {





            var parent = mainContainer();



            var imgCanvas = null;
            var bacground =new Image();
            var contextWidth = 0;
            var contextHeight = 0;
            var showImg = img();
            bacground.src = "../../../image/tamg.jpg";
            bacground.onload = function (ev1) {
                var proportion = bacground.width/bacground.height;
                contextWidth = window.innerHeight*0.8*proportion;
                contextHeight = window.innerHeight*0.8;
                imgCanvas = canvas(window.innerHeight*0.8*proportion,window.innerHeight*0.8);
                imgCanvas.context.drawImage(bacground,0,0,window.innerHeight*0.8*proportion,window.innerHeight*0.8);
                setParent(imgCanvas.canvas,parent);
               // imgCanvas = mainCanvas;

                setCSS(imgCanvas.canvas,"mainCanvas");
            };
            console.info("123");
            var nameDiv = div();
            setCSS(nameDiv,"nameDiv");

            var drawboard = null;
            nameDiv.onmousedown = function (ev1) {

                showImg.src = "signature.png";

                showImg.onload = function (ev2) {
                    imgCanvas.context.translate(contextWidth-100,window.innerHeight*0.8);
                    imgCanvas.context.rotate(-Math.PI / 2);

                    imgCanvas.context.drawImage(showImg,0,0,50,100);
                    imgCanvas.context.translate(-50,-100);
                };

            };

            //setParent(showImg,document.body);
            setCSS(showImg,"showImg");







            var saveBtn = button("保存");
            saveBtn.onmousedown = function (ev1) {

               var data64 = getBase64ImageFromCanvas(mainCanvas.canvas);
               var uploadData ={};
               uploadData.key = data64;
               $.post("http://localhost:8099/uploadImgDemo",uploadData,function (data) {
               });

            };

            var okBtn = button("ok");
            setPosition(okBtn,Vector3(0,50));

            setParent(saveBtn,parent);
            setParent(okBtn,parent);
            //setParent(imgCanvas,parent);
            okBtn.onmousedown = function (ev1) {
                hideElement(drawboard.canvas);
                hideElement(nameDiv);
                showImg.src = drawboard.canvas.toDataURL("image/png");
                showImg.onload = function (ev2) {
                    imgCanvas.context.drawImage(showImg,contextWidth - 100,contextHeight - 50,100,50);
                    console.info(imgCanvas);
                };

            };

        };
        </script>

</head>
<body>

</body>
</html>